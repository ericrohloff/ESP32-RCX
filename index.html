<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>ESP32-RCX Programmer</title>
        <link rel="stylesheet" href="styles.css" />
        <link
            rel="stylesheet"
            href="https://pyscript.net/releases/2024.1.1/core.css"
        />
        <script
            type="module"
            src="https://pyscript.net/releases/2024.1.1/core.js"
        ></script>
    </head>
    <body>
        <div class="header">
            <div>
                <h1 style="margin: 0">RCX Python Programmer</h1>
                <div id="status-bar">Status: Disconnected</div>
            </div>
            <button
                id="connect-btn"
                class="btn-connect"
                py-click="connect_serial"
            >
                Connect ESP32
            </button>
        </div>

        <div class="container">
            <div class="editor-section">
                <h3 style="margin-top: 0; color: #3498db">
                    ESP32 Standalone Script
                </h3>
                <textarea id="code-editor" spellcheck="false">
# Write your ESP32 standalone logic here
while True:
    rcx.beep()
    time.sleep(2)
            </textarea
                >
                <button id="flash-btn" class="btn-flash" py-click="flash_code">
                    Flash to ESP32
                </button>
            </div>

            <div class="control-panel">
                <h3 style="margin-top: 0">Live Diagnostics</h3>
                <button class="btn-test" py-click="live_ping">Ping RCX</button>
                <button class="btn-test" py-click="live_beep">Play Beep</button>
                <div class="packet-stream-container">
                    <h4>Packet Visualizer</h4>
                    <button class="btn-clear" py-click="clear_visualizer">
                        Clear
                    </button>
                    <div
                        id="packet-stream"
                        style="
                            background: #111;
                            height: 120px;
                            overflow-y: auto;
                            padding: 10px;
                            border-radius: 4px;
                            border: 1px solid #444;
                        "
                    ></div>

                    <div class="legend">
                        <span><b style="color: #2980b9">■</b> Preamble</span>
                        <span><b style="color: #27ae60">■</b> OpCode</span>
                        <span><b style="color: #8e44ad">■</b> Param</span>
                        <span><b style="color: #c0392b">■</b> Checksum</span>
                        <span><i>(Italic)</i> Complement</span>
                    </div>
                </div>
                <button
                    id="clear-console-btn"
                    class="btn-clear"
                    py-click="clear_console"
                >
                    Clear
                </button>
                <div id="console-log">Ready...</div>
            </div>
        </div>

        <script type="py" src="main.py" config="pyscript.json"></script>
    </body>
</html>
